# TDDとTidy First開発ガイド（改訂版）

## 🎯 核心原則

### テスト駆動開発（TDD）の基本サイクル
```
1. RED（赤）: 失敗するテストを書く
2. GREEN（緑）: テストを通す最小限のコードを書く  
3. REFACTOR（リファクタリング）: コードを改善する
```

### Tidy Firstの本質
**構造的変更**と**振る舞い変更**を明確に分離し、別々のコミットで管理する

## 📋 実践チェックリスト

### テスト作成時
- [ ] テスト名は振る舞いを説明している（例：`shouldCalculateTaxForRegularItems`）
- [ ] 1つのテストは1つの振る舞いのみをテスト
- [ ] 失敗時のメッセージが明確で有益
- [ ] 最小限の機能増分をテストしている

### 実装時
- [ ] テストを通す最小限のコードのみ実装
- [ ] 過度な一般化を避けている
- [ ] YAGNIの原則に従っている（今必要ないものは作らない）

### リファクタリング時
- [ ] 全テストがグリーンの状態から開始
- [ ] 1つのリファクタリングパターンを適用
- [ ] 各ステップ後にテストを実行
- [ ] 重複の除去を優先

## 🔄 改善されたワークフロー

### 1. 機能追加の流れ
```
開始
  ↓
最小の振る舞いを定義するテストを書く
  ↓
テスト失敗を確認（RED）
  ↓
最小限の実装（GREEN）
  ↓
構造的改善が必要？
  ├─ Yes → Tidy First（構造的変更）→ コミット
  └─ No → そのまま進む
  ↓
振る舞い変更をコミット
  ↓
次の機能増分へ
```

### 2. バグ修正の流れ
```
1. APIレベルの失敗テストを書く
2. 問題を再現する最小のユニットテストを書く
3. 両方のテストを通す修正を実装
4. リファクタリング（必要に応じて）
```

## ⚡ 実践的なアドバイス

### コミット戦略
```
構造的変更のコミット例：
"refactor: メソッドを抽出してUserValidatorクラスに移動"

振る舞い変更のコミット例：
"feat: 消費税計算機能を追加"
```

### よくある落とし穴と対策

1. **テストが大きすぎる**
   - 対策：より小さな振る舞いに分解する

2. **実装が過度に複雑**
   - 対策：シンプルな解決策から始める

3. **構造と振る舞いの混在**
   - 対策：変更を2つのステップに分ける

## 📊 品質指標

- テストの実行時間：高速（数秒以内）
- テストカバレッジ：振る舞いベースで100%を目指す
- メソッドの行数：10行以下を推奨
- クラスの責務：単一責任の原則を厳守

## 🚀 実装開始の準備

plan.mdファイルを確認し、次の未実装テストを特定する準備ができています。「go」の指示があれば、以下の手順で進めます：

1. plan.md内の次の未マークテストを検索
2. そのテストを実装（RED phase）
3. テストを通す最小限のコードを実装（GREEN phase）
4. 必要に応じてリファクタリング（REFACTOR phase）

## 🔍 批判的レビューのポイント

### 元ドキュメントの良い点
- TDDの基本サイクルが明確
- Tidy Firstの概念が適切に説明されている
- コミットの規律が厳格

### 改善した点
1. **視覚的な構造化**: フローチャートとチェックリストで実践しやすく
2. **日本語化**: 日本人開発者にとって理解しやすい表現に
3. **実践的な例**: 具体的なコミットメッセージ例を追加
4. **落とし穴と対策**: よくある問題への対処法を明記
5. **品質指標**: 測定可能な目標を設定

### 追加考慮事項
- チーム開発では、これらの原則を共有し、コードレビューで確認
- CI/CDパイプラインでテスト自動実行を設定
- ペアプログラミングやモブプログラミングでTDD実践を共有